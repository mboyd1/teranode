<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1196px" preserveAspectRatio="none" style="width:1254px;height:1196px;background:#F0F8FF;" version="1.1" viewBox="0 0 1254 1196" width="1254px" zoomAndPan="magnify"><defs/><g><rect fill="#F0F8FF" height="1196" style="stroke:none;stroke-width:1;" width="1254" x="0" y="0"/><g><title>BlockAssemblyClient</title><rect fill="#FFFFFF" height="829.9844" style="stroke:#181818;stroke-width:1;" width="10" x="210.374" y="266.6621"/></g><g><title>BlockAssemblyServer</title><rect fill="#FFFFFF" height="771.3633" style="stroke:#181818;stroke-width:1;" width="10" x="399.5869" y="295.9727"/></g><g><title>BlockAssembler</title><rect fill="#FFFFFF" height="595.5" style="stroke:#181818;stroke-width:1;" width="10" x="658.6304" y="383.9043"/></g><g><title>SubtreeProcessor</title><rect fill="#FFFFFF" height="39.9658" style="stroke:#181818;stroke-width:1;" width="10" x="926.791" y="423.8701"/></g><g><title>SubtreeProcessor</title><rect fill="#FFFFFF" height="39.9658" style="stroke:#181818;stroke-width:1;" width="10" x="926.791" y="585.3779"/></g><g><title>BlockchainClient</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="1134.0244" y="325.2832"/></g><rect fill="none" height="272.3945" style="stroke:#000000;stroke-width:1.5;" width="930.9497" x="306.1514" y="478.8359"/><rect fill="none" height="103.8867" style="stroke:#000000;stroke-width:1.5;" width="530.0205" x="316.1514" y="640.3438"/><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="Miner" id="part1-lifeline"><g><title>Miner</title><rect fill="#000000" fill-opacity="0.00000" height="1047.1582" width="8" x="27.1611" y="67.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="31" x2="31" y1="67.4883" y2="1114.6465"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="Client" id="part2-lifeline"><g><title>BlockAssemblyClient</title><rect fill="#000000" fill-opacity="0.00000" height="1047.1582" width="8" x="211.374" y="67.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="215.1074" x2="215.1074" y1="67.4883" y2="1114.6465"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="Server" id="part3-lifeline"><g><title>BlockAssemblyServer</title><rect fill="#000000" fill-opacity="0.00000" height="1047.1582" width="8" x="400.5869" y="67.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="404.1514" x2="404.1514" y1="67.4883" y2="1114.6465"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="Assembler" id="part4-lifeline"><g><title>BlockAssembler</title><rect fill="#000000" fill-opacity="0.00000" height="1047.1582" width="8" x="659.6304" y="67.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="663.0093" x2="663.0093" y1="67.4883" y2="1114.6465"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="SubtreeProc" id="part5-lifeline"><g><title>SubtreeProcessor</title><rect fill="#000000" fill-opacity="0.00000" height="1047.1582" width="8" x="927.791" y="67.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="931.1694" x2="931.1694" y1="67.4883" y2="1114.6465"/></g></g><g class="participant-lifeline" data-entity-uid="part6" data-qualified-name="JobStore" id="part6-lifeline"><g><title>JobStore</title><rect fill="#000000" fill-opacity="0.00000" height="1047.1582" width="8" x="1030.7476" y="67.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1034.4126" x2="1034.4126" y1="67.4883" y2="1114.6465"/></g></g><g class="participant-lifeline" data-entity-uid="part7" data-qualified-name="BlockchainClient" id="part7-lifeline"><g><title>BlockchainClient</title><rect fill="#000000" fill-opacity="0.00000" height="1047.1582" width="8" x="1135.0244" y="67.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1138.0825" x2="1138.0825" y1="67.4883" y2="1114.6465"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="Miner" id="part1-head"><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="52.3223" x="5" y="36"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.3223" x="12" y="56.5352">Miner</text></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="Miner" id="part1-tail"><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="52.3223" x="5" y="1113.6465"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="38.3223" x="12" y="1134.1816">Miner</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="Client" id="part2-head"><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="154.5332" x="138.1074" y="36"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140.5332" x="145.1074" y="56.5352">BlockAssemblyClient</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="Client" id="part2-tail"><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="154.5332" x="138.1074" y="1113.6465"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140.5332" x="145.1074" y="1134.1816">BlockAssemblyClient</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="Server" id="part3-head"><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="156.8711" x="326.1514" y="36"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="142.8711" x="333.1514" y="56.5352">BlockAssemblyServer</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="Server" id="part3-tail"><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="156.8711" x="326.1514" y="1113.6465"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="142.8711" x="333.1514" y="1134.1816">BlockAssemblyServer</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="Assembler" id="part4-head"><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107.2422" x="607.0093" y="64.5352">BlockAssembler</text><ellipse cx="663.6304" cy="35" fill="#DDDDDD" rx="12" ry="12" style="stroke:#666666;stroke-width:0.5;"/><line style="stroke:#666666;stroke-width:0.5;" x1="651.6304" x2="675.6304" y1="49" y2="49"/></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="Assembler" id="part4-tail"><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107.2422" x="607.0093" y="1127.1816">BlockAssembler</text><ellipse cx="663.6304" cy="1146.1348" fill="#DDDDDD" rx="12" ry="12" style="stroke:#666666;stroke-width:0.5;"/><line style="stroke:#666666;stroke-width:0.5;" x1="651.6304" x2="675.6304" y1="1160.1348" y2="1160.1348"/></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="SubtreeProc" id="part5-head"><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.2432" x="870.1694" y="64.5352">SubtreeProcessor</text><ellipse cx="931.791" cy="35" fill="#DDDDDD" rx="12" ry="12" style="stroke:#666666;stroke-width:0.5;"/><line style="stroke:#666666;stroke-width:0.5;" x1="919.791" x2="943.791" y1="49" y2="49"/></g><g class="participant participant-tail" data-entity-uid="part5" data-qualified-name="SubtreeProc" id="part5-tail"><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.2432" x="870.1694" y="1127.1816">SubtreeProcessor</text><ellipse cx="931.791" cy="1146.1348" fill="#DDDDDD" rx="12" ry="12" style="stroke:#666666;stroke-width:0.5;"/><line style="stroke:#666666;stroke-width:0.5;" x1="919.791" x2="943.791" y1="1160.1348" y2="1160.1348"/></g><g class="participant participant-head" data-entity-uid="part6" data-qualified-name="JobStore" id="part6-head"><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.6699" x="1003.4126" y="64.5352">JobStore</text><path d="M1016.7476,15 C1016.7476,5 1034.7476,5 1034.7476,5 C1034.7476,5 1052.7476,5 1052.7476,15 L1052.7476,41 C1052.7476,51 1034.7476,51 1034.7476,51 C1034.7476,51 1016.7476,51 1016.7476,41 L1016.7476,15" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1016.7476,15 C1016.7476,25 1034.7476,25 1034.7476,25 C1034.7476,25 1052.7476,25 1052.7476,15" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-entity-uid="part6" data-qualified-name="JobStore" id="part6-tail"><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.6699" x="1003.4126" y="1127.1816">JobStore</text><path d="M1016.7476,1140.1348 C1016.7476,1130.1348 1034.7476,1130.1348 1034.7476,1130.1348 C1034.7476,1130.1348 1052.7476,1130.1348 1052.7476,1140.1348 L1052.7476,1166.1348 C1052.7476,1176.1348 1034.7476,1176.1348 1034.7476,1176.1348 C1034.7476,1176.1348 1016.7476,1176.1348 1016.7476,1166.1348 L1016.7476,1140.1348" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1016.7476,1140.1348 C1016.7476,1150.1348 1034.7476,1150.1348 1034.7476,1150.1348 C1034.7476,1150.1348 1052.7476,1150.1348 1052.7476,1140.1348" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-entity-uid="part7" data-qualified-name="BlockchainClient" id="part7-head"><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="125.8838" x="1076.0825" y="36"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111.8838" x="1083.0825" y="56.5352">BlockchainClient</text></g><g class="participant participant-tail" data-entity-uid="part7" data-qualified-name="BlockchainClient" id="part7-tail"><rect fill="#DDDDDD" height="30.4883" rx="2.5" ry="2.5" style="stroke:#666666;stroke-width:0.5;" width="125.8838" x="1076.0825" y="1113.6465"/><text fill="#333333" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111.8838" x="1083.0825" y="1134.1816">BlockchainClient</text></g><g><title>BlockAssemblyClient</title><rect fill="#FFFFFF" height="829.9844" style="stroke:#181818;stroke-width:1;" width="10" x="210.374" y="266.6621"/></g><g><title>BlockAssemblyServer</title><rect fill="#FFFFFF" height="771.3633" style="stroke:#181818;stroke-width:1;" width="10" x="399.5869" y="295.9727"/></g><g><title>BlockAssembler</title><rect fill="#FFFFFF" height="595.5" style="stroke:#181818;stroke-width:1;" width="10" x="658.6304" y="383.9043"/></g><g><title>SubtreeProcessor</title><rect fill="#FFFFFF" height="39.9658" style="stroke:#181818;stroke-width:1;" width="10" x="926.791" y="423.8701"/></g><g><title>SubtreeProcessor</title><rect fill="#FFFFFF" height="39.9658" style="stroke:#181818;stroke-width:1;" width="10" x="926.791" y="585.3779"/></g><g><title>BlockchainClient</title><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1;" width="10" x="1134.0244" y="325.2832"/></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1247.1011" x="0" y="98.1436"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1247.1011" y1="98.1436" y2="98.1436"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1247.1011" y1="101.1436" y2="101.1436"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="295.6265" x="475.7373" y="87.4883"/><text fill="#333333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="277.3418" x="481.7373" y="104.0566">Background: Pre-computed Data Updates</text><path d="M765,125.7988 L765,196.7988 L1097,196.7988 L1097,135.7988 L1087,125.7988 L765,125.7988" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1087,125.7988 L1087,135.7988 L1097,135.7988 L1087,125.7988" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241.6743" x="771" y="143.3672">SubtreeProcessor atomically publishes</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283.4292" x="771" y="158.6777">PrecomputedMiningData (subtree snapshots)</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258.6924" x="771" y="173.9883">whenever a subtree completes or a block</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311.6064" x="771" y="189.2988">is processed via updatePrecomputedMiningData()</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1247.1011" x="0" y="222.6963"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1247.1011" y1="222.6963" y2="222.6963"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1247.1011" y1="225.6963" y2="225.6963"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2;" width="194.1592" x="526.4709" y="212.041"/><text fill="#333333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="175.8745" x="532.4709" y="228.6094">Mining Candidate Request</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg1"><polygon fill="#666666" points="198.374,262.6621,208.374,266.6621,198.374,270.6621,202.374,266.6621" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;" x1="31.1611" x2="204.374" y1="266.6621" y2="266.6621"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.0508" x="38.1611" y="261.9199">GetMiningCandidate(ctx)</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg2"><polygon fill="#666666" points="387.5869,291.9727,397.5869,295.9727,387.5869,299.9727,391.5869,295.9727" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;" x1="220.374" x2="393.5869" y1="295.9727" y2="295.9727"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.0508" x="227.374" y="291.2305">GetMiningCandidate(ctx)</text></g><g class="message" data-entity-1="part3" data-entity-2="part7" id="msg3"><polygon fill="#666666" points="1122.0244,321.2832,1132.0244,325.2832,1122.0244,329.2832,1126.0244,325.2832" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;" x1="409.5869" x2="1128.0244" y1="325.2832" y2="325.2832"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266.2334" x="416.5869" y="320.541">IsFSMCurrentState(ctx, FSMStateRUNNING)</text></g><g class="message" data-entity-1="part7" data-entity-2="part3" id="msg4"><polygon fill="#666666" points="420.5869,350.5938,410.5869,354.5938,420.5869,358.5938,416.5869,354.5938" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="414.5869" x2="1138.0244" y1="354.5938" y2="354.5938"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62.7402" x="426.5869" y="349.8516">isRunning</text></g><g class="message" data-entity-1="part3" data-entity-2="part4" id="msg5"><polygon fill="#666666" points="646.6304,379.9043,656.6304,383.9043,646.6304,387.9043,650.6304,383.9043" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;" x1="409.5869" x2="652.6304" y1="383.9043" y2="383.9043"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156.0508" x="416.5869" y="379.1621">GetMiningCandidate(ctx)</text></g><g class="message" data-entity-1="part4" data-entity-2="part5" id="msg6"><polygon fill="#666666" points="914.791,419.8701,924.791,423.8701,914.791,427.8701,918.791,423.8701" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;" x1="668.6304" x2="920.791" y1="423.8701" y2="423.8701"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184.9326" x="675.6304" y="419.1279">GetPrecomputedMiningData()</text></g><path d="M941,396.9043 L941,436.9043 L1138,436.9043 L1138,406.9043 L1128,396.9043 L941,396.9043" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1128,396.9043 L1128,406.9043 L1138,406.9043 L1128,396.9043" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125.9375" x="947" y="414.4727">Atomic pointer read</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.2554" x="947" y="429.7832">(lock-free, no channel sync)</text><g class="message" data-entity-1="part5" data-entity-2="part4" id="msg8"><polygon fill="#666666" points="679.6304,459.8359,669.6304,463.8359,679.6304,467.8359,675.6304,463.8359" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="673.6304" x2="930.791" y1="463.8359" y2="463.8359"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197.9707" x="685.6304" y="459.0938">return PrecomputedMiningData</text></g><path d="M306.1514,478.8359 L368.29,478.8359 L368.29,486.1465 L358.29,496.1465 L306.1514,496.1465 L306.1514,478.8359" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="272.3945" style="stroke:#000000;stroke-width:1.5;" width="930.9497" x="306.1514" y="478.8359"/><text fill="#333333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="321.1514" y="492.4043">alt</text><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="368.0059" x="383.29" y="491.4707">[Precomputed data has completed subtrees for current chain tip]</text><g class="message" data-entity-1="part4" data-entity-2="part4" id="msg9"><line style="stroke:#666666;stroke-width:1;" x1="668.6304" x2="710.6304" y1="517.457" y2="517.457"/><line style="stroke:#666666;stroke-width:1;" x1="710.6304" x2="710.6304" y1="517.457" y2="530.457"/><line style="stroke:#666666;stroke-width:1;" x1="669.6304" x2="710.6304" y1="530.457" y2="530.457"/><polygon fill="#666666" points="679.6304,526.457,669.6304,530.457,679.6304,534.457,675.6304,530.457" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169.3364" x="675.6304" y="512.7148">Use precomputed subtrees</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="306.1514" x2="1237.1011" y1="539.457" y2="539.457"/><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="193.252" x="311.1514" y="550.0918">[No completed subtrees available]</text><g class="message" data-entity-1="part4" data-entity-2="part5" id="msg10"><polygon fill="#666666" points="914.791,581.3779,924.791,585.3779,914.791,589.3779,918.791,585.3779" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;" x1="668.6304" x2="920.791" y1="585.3779" y2="585.3779"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239.1606" x="675.6304" y="580.6357">GetIncompleteSubtreeMiningData(ctx)</text></g><path d="M941,558.4121 L941,598.4121 L1226,598.4121 L1226,568.4121 L1216,558.4121 L941,558.4121" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1216,558.4121 L1216,568.4121 L1226,568.4121 L1216,558.4121" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.3916" x="947" y="575.9805">On-demand snapshot</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264.3101" x="947" y="591.291">(channel request to processing goroutine)</text><g class="message" data-entity-1="part5" data-entity-2="part4" id="msg12"><polygon fill="#666666" points="679.6304,621.3438,669.6304,625.3438,679.6304,629.3438,675.6304,625.3438" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="673.6304" x2="930.791" y1="625.3438" y2="625.3438"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226.2559" x="685.6304" y="620.6016">return incomplete subtree snapshot</text></g><path d="M316.1514,640.3438 L378.29,640.3438 L378.29,647.6543 L368.29,657.6543 L316.1514,657.6543 L316.1514,640.3438" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="103.8867" style="stroke:#000000;stroke-width:1.5;" width="530.0205" x="316.1514" y="640.3438"/><text fill="#333333" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="331.1514" y="653.9121">alt</text><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="214.8491" x="393.29" y="652.9785">[Incomplete subtree has transactions]</text><g class="message" data-entity-1="part4" data-entity-2="part4" id="msg13"><line style="stroke:#666666;stroke-width:1;" x1="668.6304" x2="710.6304" y1="678.9648" y2="678.9648"/><line style="stroke:#666666;stroke-width:1;" x1="710.6304" x2="710.6304" y1="678.9648" y2="691.9648"/><line style="stroke:#666666;stroke-width:1;" x1="669.6304" x2="710.6304" y1="691.9648" y2="691.9648"/><polygon fill="#666666" points="679.6304,687.9648,669.6304,691.9648,679.6304,695.9648,675.6304,691.9648" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148.5415" x="675.6304" y="674.2227">Use incomplete subtree</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="316.1514" x2="846.1719" y1="700.9648" y2="700.9648"/><text fill="#333333" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="129.25" x="321.1514" y="711.5996">[No transactions at all]</text><g class="message" data-entity-1="part4" data-entity-2="part3" id="msg14"><polygon fill="#666666" points="420.5869,732.2305,410.5869,736.2305,420.5869,740.2305,416.5869,736.2305" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="414.5869" x2="657.6304" y1="736.2305" y2="736.2305"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.083" x="426.5869" y="731.4883">return empty block template</text></g><g class="message" data-entity-1="part4" data-entity-2="part4" id="msg15"><line style="stroke:#666666;stroke-width:1;" x1="668.6304" x2="710.6304" y1="779.541" y2="779.541"/><line style="stroke:#666666;stroke-width:1;" x1="710.6304" x2="710.6304" y1="779.541" y2="792.541"/><line style="stroke:#666666;stroke-width:1;" x1="669.6304" x2="710.6304" y1="792.541" y2="792.541"/><polygon fill="#666666" points="679.6304,788.541,669.6304,792.541,679.6304,796.541,675.6304,792.541" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.793" x="675.6304" y="774.7988">filterSubtreesByMaxSize()</text></g><g class="message" data-entity-1="part4" data-entity-2="part4" id="msg16"><line style="stroke:#666666;stroke-width:1;" x1="668.6304" x2="710.6304" y1="837.1621" y2="837.1621"/><line style="stroke:#666666;stroke-width:1;" x1="710.6304" x2="710.6304" y1="837.1621" y2="850.1621"/><line style="stroke:#666666;stroke-width:1;" x1="669.6304" x2="710.6304" y1="850.1621" y2="850.1621"/><polygon fill="#666666" points="679.6304,846.1621,669.6304,850.1621,679.6304,854.1621,675.6304,850.1621" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151.9565" x="675.6304" y="817.1094">Compute derived values</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185.0532" x="675.6304" y="832.4199">(fees, tx count, merkle proof)</text></g><g class="message" data-entity-1="part4" data-entity-2="part4" id="msg17"><line style="stroke:#666666;stroke-width:1;" x1="668.6304" x2="710.6304" y1="879.4727" y2="879.4727"/><line style="stroke:#666666;stroke-width:1;" x1="710.6304" x2="710.6304" y1="879.4727" y2="892.4727"/><line style="stroke:#666666;stroke-width:1;" x1="669.6304" x2="710.6304" y1="892.4727" y2="892.4727"/><polygon fill="#666666" points="679.6304,888.4727,669.6304,892.4727,679.6304,896.4727,675.6304,892.4727" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.3809" x="675.6304" y="874.7305">getNextNbits()</text></g><path d="M788.3809,866.6621 L788.3809,891.6621 L982.3809,891.6621 L982.3809,876.6621 L972.3809,866.6621 L788.3809,866.6621" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M972.3809,866.6621 L972.3809,876.6621 L982.3809,876.6621 L972.3809,866.6621" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173.3672" x="794.3809" y="884.2305">Check difficulty adjustment</text><g class="message" data-entity-1="part4" data-entity-2="part4" id="msg19"><line style="stroke:#666666;stroke-width:1;" x1="668.6304" x2="710.6304" y1="937.0938" y2="937.0938"/><line style="stroke:#666666;stroke-width:1;" x1="710.6304" x2="710.6304" y1="937.0938" y2="950.0938"/><line style="stroke:#666666;stroke-width:1;" x1="669.6304" x2="710.6304" y1="950.0938" y2="950.0938"/><polygon fill="#666666" points="679.6304,946.0938,669.6304,950.0938,679.6304,954.0938,675.6304,950.0938" style="stroke:#666666;stroke-width:1;"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152.2612" x="675.6304" y="917.041">Calculate coinbaseValue</text><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166.5371" x="675.6304" y="932.3516">(totalFees + blockSubsidy)</text></g><g class="message" data-entity-1="part4" data-entity-2="part3" id="msg20"><polygon fill="#666666" points="420.5869,975.4043,410.5869,979.4043,420.5869,983.4043,416.5869,979.4043" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="414.5869" x2="662.6304" y1="979.4043" y2="979.4043"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225.0435" x="426.5869" y="974.6621">return mining candidate + subtrees</text></g><g class="message" data-entity-1="part3" data-entity-2="part6" id="msg21"><polygon fill="#666666" points="1022.7476,1004.7148,1032.7476,1008.7148,1022.7476,1012.7148,1026.7476,1008.7148" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;" x1="409.5869" x2="1028.7476" y1="1008.7148" y2="1008.7148"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269.3882" x="416.5869" y="1003.9727">Set(*id, &amp;subtreeprocessor.Job{...}, jobTTL)</text></g><g class="message" data-entity-1="part3" data-entity-2="part7" id="msg22"><polygon fill="#666666" points="1127.0244,1034.0254,1137.0244,1038.0254,1127.0244,1042.0254,1131.0244,1038.0254" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;" x1="409.5869" x2="1133.0244" y1="1038.0254" y2="1038.0254"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="533.2793" x="416.5869" y="1033.2832">SendNotification(ctx, &amp;blockchain.Notification{Type: NotificationType_MiningOn, ...})</text></g><g class="message" data-entity-1="part3" data-entity-2="part2" id="msg23"><polygon fill="#666666" points="231.374,1063.3359,221.374,1067.3359,231.374,1071.3359,227.374,1067.3359" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="225.374" x2="403.5869" y1="1067.3359" y2="1067.3359"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.2129" x="237.374" y="1062.5938">Return mining candidate</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg24"><polygon fill="#666666" points="42.1611,1092.6465,32.1611,1096.6465,42.1611,1100.6465,38.1611,1096.6465" style="stroke:#666666;stroke-width:1;"/><line style="stroke:#666666;stroke-width:1;stroke-dasharray:2,2;" x1="36.1611" x2="214.374" y1="1096.6465" y2="1096.6465"/><text fill="#333333" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155.2129" x="48.1611" y="1091.9043">Return mining candidate</text></g><text fill="#333333" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="155.4346" x="0" y="1186.8027">Last Modified On: 09-Feb-2026</text><?plantuml-src fLPjRnf74Fw-ls94r1GQG9KgLHMIAyLOHAu2ZeoTJvMglRivs7ZPlUxEEIPM_djdxmMM0rohlG_ezdRccRTdPl0FoXJIoGqaCdrOELkQR6grTV1czlFijzbC-9r4XhaiDSsieKRab-g9HAHpzcjp-Mlr2F4ZN66k349YNOREGywtKcj0ZHiqv2DzFYhQmhC0kAoa3x7uQzVBg-eHtqM4ahA7pkh_2yE_f59LI4F_3Kg86A8tvoIu7aWFrTlXvQMswSDxxt6JwErKAyv49Lg_lY2xHFVOmDQleadYWLWZiJljX9PbGWxnaxCfUcyReFr7aKcIYVG8lJziiYJhi19f3oSyIzTIcIY4xaSXBYwYj4tWayDHQZT5IPZ15Tk3-uBDeeUB2s4i8LYEwy0hWAxZ8CbkLCh4sa9H9bhvDNgMO_0MczEkpAeoqFUrEdWZ2x-sv0Si-tMD1eCf2UrzqDKOV0ac80cniAJoKDIMsUL79Q6iF3vfh3_WR6SG0gb2hszWAascWXBSujybUWhHYeeQCFgzAJnCu0DIhR5JwAVqD10o9VKOrDkiDXgiMnFXDReDPKIZmRhTQZ7AjPyjvzFIEJukgG4P0d-iJhVtYyNruaE4UbJn8z1HxANojwK9NeeCpsD4Fkve_9eGzvmNUxrWVa-W6kPSyIe6EhLQqmJULoI3mYf33EDGPd-QVd1rb3FOaAiCxBGngC5lJHgdEg9lR7lK2SWXbSwSvcsSe1XFI4sn1eIkXJKtNylVh6LqFN_JkffG9HX85SpfW-p47jrpznSHU8iaKFFDmfuo8X-bqf81ki17QRyshNfp5IM_gYH0N84RCyfmmxNUjIuNe4svQpg9RDkUeTDMbWSDSMC5h9FvEnWdvogYTev2Ttemm9dAi44kpVMnQYWEEMbyKBCcZAf_AS6nVTPfIn13yIWC2xQB6BTS4n9k2bu2rL03ueDczmEeoSB8wZHCx4-kDFE_2THVRkVoQQc-8NVBMPLfJHzEb5EFOMfApRNYukMCC0HwOXgLXeQmGVUW0-EipL_0Mo4jy8aMYIBVwTBf6ZcWJEMvIlaVonPazgNq5FvjlE2Vr2mSwfToTuULzpbuo0wI9QbdWTNlwbnnt5vbsy51WawaTrDF-dGtwT_jUoVYIpIXzZEkNR2CjaJg_wIo8Rnjj8jswOrPwday7dyVmXURtDrz7BmyoPTSrOKbnNcHWIhr87-Rx2J7yUtptRR02SIVmfU_wWQzCKC8fWTxh-ErTNiw1GSJh5a-qKwerz-hjDkre34ddcaspEEFafj_RhdoYXbsOoRmGxKHUbasci_deoq_lO7u1m00?></g></svg>